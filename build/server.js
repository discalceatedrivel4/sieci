!function(n){function e(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var t={};e.m=n,e.c=t,e.d=function(n,t,o){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:o})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=2)}([function(n,e){n.exports=require("fs")},function(n,e){n.exports=require("mongodb")},function(n,e,t){"use strict";function o(n){h=n,console.log("Data received from worker"),v.broadcast("ST"+n);c.MongoClient.connect(g,function(e,t){if(e)console.error(e);else{t.collection("ml").replaceOne({name:b},{name:b,data:n},function(n,e){n?console.error(n):console.log("Succesfully inserted data"),t.close()})}})}function r(){return new Promise(function(n,e){c.MongoClient.connect(g,function(t,o){if(t)console.error(t);else{o.collection("ml").findOne({name:b},function(t,r){t?(console.error(t),e()):(console.log("Result:"),n(r)),o.close()})}})})}Object.defineProperty(e,"__esModule",{value:!0});var i=t(3),s=t(4),a=(t(0),t(5)),c=t(1),u=t(6),l=t(7),f=t(8),g=process.env.MONGO_URL||"",d=s();d.use("/",s.static(u.join(__dirname,"client"))),d.get("/*",function(n,e){return e.sendFile(u.join(__dirname,"client","index.html"))});var p=a.createServer(d),v=new l.Server({server:p}),m=process.env.PORT||"8080";p.listen(m,function(){return console.log((new Date).toString().split(" ")[4]+" - Server is listening on port "+p.address().port)});var h,O,S=[],N=[],b="123";f.readFilenamesInDirectory("build/data").then(function(n){for(var e=0,t=n;e<t.length;e++){var o=t[e];!function(n){f.getStringDataFromFile("build/data/"+n).then(function(n){return f.transformData(n)}).then(function(e){if(0!==e.length){var t="PZU - "+n.substring(0,n.length-4);S.push({desc:t,data:e}),N.push(t)}})}(o)}});var D=!1,x=i.fork("build/ml.js");x.on("message",o),x.on("exit",function(){console.log("Process got killed"),process.exit(1)}),v.on("connection",function(n){n.send("RU"+JSON.stringify({running:D})),0!==N.length&&n.send("NA"+JSON.stringify(N)),void 0!==h&&n.send("ST"+h),n.on("message",function(e){switch(e.substring(0,2)){case"ST":var t=JSON.parse(e.substring(2));O=t.options.fileName,"fresh"===t.options.startMode?(t.options.inputValue="",x.send(JSON.stringify({configData:t,inputData:S})),D=!0,n.send("RU"+JSON.stringify({running:D}))):"file"===t.options.startMode?r().then(function(e){t.options.inputValue=e.data,x.send(JSON.stringify({configData:t,inputData:S})),D=!0,n.send("RU"+JSON.stringify({running:D}))}):(x.send(JSON.stringify({configData:t,inputData:S})),D=!0,n.send("RU"+JSON.stringify({running:D})));break;case"SP":process.exit(1),x.kill(),D=!1,setTimeout(function(){return n.send("RU"+JSON.stringify({running:D}))},100);break;case"DA":for(var o=e.substring(2),i=0,s=S;i<s.length;i++){var a=s[i];if(a.desc===o){n.send("IN"+JSON.stringify(a));break}}}})}),process.env.AUTORUN&&setTimeout(function(){D||r().then(function(n){var e={options:{}};e.options.inputValue=n.data,x.send(JSON.stringify({configData:e,inputData:S})),D=!0})},3e4),process.env.URL&&setInterval(function(){console.log("Anti-idler"),a.get(process.env.url)},15e5)},function(n,e){n.exports=require("child_process")},function(n,e){n.exports=require("express")},function(n,e){n.exports=require("http")},function(n,e){n.exports=require("path")},function(n,e){n.exports=require("uws")},function(n,e,t){"use strict";function o(n){f.MongoClient.connect(g,function(e,t){if(e)console.error(e);else{t.collection("wse").find({date:{$gte:n}}).toArray(function(n,e){if(n)console.error(n);else{if(console.log("Result:"),console.log(e),!e.length||0===e.length)throw"No data";for(var o=0,r=e;o<r.length;o++){var i=r[o];c("src/data/dump/"+i.date+".txt",i.data)}}t.close()})}})}function r(n,e){return new Promise(function(t,o){var r=[];f.MongoClient.connect(g,function(i,s){if(i)console.error(i);else{s.collection("wse").findOne({date:e},function(e,i){if(e)console.error(e),o();else{if(console.log("Result:"),!i.data)throw"No data";for(var a=0,c=i.data;a<c.length;a++){var u=c[a];-1!==u.indexOf("T2,"+n)&&r.push(u)}}s.close(),t(r)})}})})}function i(n){return new Promise(function(e,t){l.readdir(n,function(n,o){n?t(n):e(o)})})}function s(n,e){for(var t=[],o=0,r=n;o<r.length;o++){var i=r[o];-1!==i.indexOf("T2,"+e)&&t.push(i)}return t}function a(n){return new Promise(function(e,t){l.readFile(n,"utf8",function(n,o){n?t(n):e(o.split("\n"))})})}function c(n,e){for(var t=l.createWriteStream(n,{flags:"a"}),o=0,r=e;o<r.length;o++){var i=r[o];t.write(i+"\n")}}function u(n){var e=[],t=Number(n[0].split(",")[5]),o=n[0].split(",")[2],r=n[n.length-1].split(",")[2];if("090000"!==o||r<"170000")return e;for(var i=0,s=n;i<s.length;i++){var a=s[i],c=a.split(","),u=Number(c[5]),l=c[2];"090000"!==l&&l<"170000"&&e.push({value:(u-t)/t*100*100,volume:Number(c[6]),time:l})}return e}Object.defineProperty(e,"__esModule",{value:!0});var l=t(0),f=t(1),g=process.env.MONGO_URL||"";e.getAllDataFromMongoSince=o,e.getStringDataFromMongo=r,e.readFilenamesInDirectory=i,e.chooseDataOfStock=s,e.getStringDataFromFile=a,e.saveDataToFile=c,e.transformData=u}]);