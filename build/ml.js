!function(e){function t(r){if(n[r])return n[r].exports;var s=n[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(){s.run(),setTimeout(function(){return r()},0)}Object.defineProperty(t,"__esModule",{value:!0});var s,i=n(1),o=n(2);process.on("message",function(e){var n=JSON.parse(e);t.CONFIG=JSON.parse(n.config);var a=JSON.parse(n.inputData);console.log(t.CONFIG),t.GLOBALS=new i.Globals,s=new o.Runner,s.inputData=a,r()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.currentNeuronId=0,this.currentSynapseId=0,this.synapseMutations=[],this.neuronMutations=[]}return e}();t.Globals=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(3),i=n(5),o=function(){function e(){this.speciesArray=[],this.currentStep=0;var e=new s.Network;e.initBasicNetwork(),this.bestNetwork=e,this.bestNetwork.fitness=0;var t=new i.Species(e);t.networks.push(e),this.speciesArray.push(t);for(var n=0;n<r.CONFIG.networksNumber-1;n++){var o=new s.Network;o.initBasicNetwork(),t.networks.push(o)}this.printResults()}return e.prototype.printResults=function(){for(var e=[],t=0,n=this.speciesArray;t<n.length;t++){var s=n[t];e.push(s.serialize())}process.send(JSON.stringify({step:this.currentStep,bestNetwork:this.bestNetwork.serialize(),speciesArray:e,globals:r.GLOBALS}))},e.prototype.run=function(){for(var e=0,t=0,n=this.speciesArray;t<n.length;t++){var s=n[t];s.averageFitness=0;for(var o=0,a=s.networks;o<a.length;o++){var u=a[o];u.fitness=1;for(var h=void 0,p=0,v=this.inputData;p<v.length;p++){var l=v[p];u.inputs[0].value=l.value,u.inputs[1].value=l.volume;var d=u.evaluate();if(d>.9&&void 0===h)h=l.value;else if(d<.1&&void 0!==h){var f=l.value-h-38;u.fitness+=f,h=void 0}}s.averageFitness+=u.fitness}s.averageFitness=s.averageFitness/s.networks.length,s.averageFitness>0&&(e+=s.averageFitness)}for(var g=0,c=this.speciesArray;g<c.length;g++){var s=c[g];s.desiredPopulation=Math.floor(s.averageFitness/e*r.CONFIG.networksNumber),s.desiredPopulation<0&&(s.desiredPopulation=1)}this.currentStep%50==0&&(this.printResults(),console.log(this.currentStep)),this.culling();for(var y=0,w=this.speciesArray;y<w.length;y++){var s=w[y];s.networks[0].fitness>this.bestNetwork.fitness&&(this.bestNetwork=s.networks[0].deepCopy())}for(var N=0,I=this.speciesArray;N<I.length;N++)for(var s=I[N],S=s.networks.length;S<s.desiredPopulation;){var O=s.networks[Math.floor(Math.random()*s.networks.length)],k=s.networks[Math.floor(Math.random()*s.networks.length)],b=this.crossover(O,k);b.mutate();for(var M=!1,L=0,G=this.speciesArray;L<G.length;L++){var A=G[L];if(A.inSpecies(b)){A.networks.push(b),M=!0;break}}if(!M){var m=new i.Species(b);m.networks.push(b),this.speciesArray.push(m)}S++}this.currentStep++},e.prototype.culling=function(){for(var e=0,t=this.speciesArray;e<t.length;e++){var n=t[e];n.networks.sort(function(e,t){return t.fitness-e.fitness});var s=Math.floor(n.networks.length*r.CONFIG.cullingPercent);n.networks.splice(n.networks.length-s,s)}},e.prototype.crossover=function(e,t){var n,r;e.fitness>=t.fitness?(n=e,r=t):(n=t,r=e);for(var i=new s.Network,o=0,a=n.inputs;o<a.length;o++){var u=a[o];i.inputs.push(u.clone())}for(var h=0,p=n.hidden;h<p.length;h++){var u=p[h];i.hidden.push(u.clone())}i.output=n.output.clone();for(var v=0,l=n.hidden;v<l.length;v++)for(var u=l[v],d=0,f=u.synapses;d<f.length;d++){var g=f[d],c=r.isSynapseInHiddenWithId(g.innovation);if(c.result){var y=i.findNeuronWithId(g.origin.id),w=i.findNeuronWithId(u.id),N=g.clone(y),I=Math.random();I<.5&&(N.weight=c.weight),w.synapses.push(N)}else{var y=i.findNeuronWithId(g.origin.id),w=i.findNeuronWithId(u.id),N=g.clone(y);w.synapses.push(N)}}for(var S=0,O=n.output.synapses;S<O.length;S++){var g=O[S],c=r.isSynapseInOutputWithId(g.innovation);if(c.result){var y=i.findNeuronWithId(g.origin.id),N=g.clone(y),I=Math.random();I<.5&&(N.weight=c.weight),i.output.synapses.push(N)}else{var y=i.findNeuronWithId(g.origin.id),N=g.clone(y);i.output.synapses.push(N)}}return i},e.prototype.testChildNetworkNoSynapses=function(e,t,n){for(var r=0,s=n.hidden;r<s.length;r++){var i=s[r];if(0===i.synapses.length){for(var o=0,a=0,u=n.hidden;a<u.length;a++)for(var h=u[a],p=0,v=h.synapses;p<v.length;p++){var l=v[p];l.origin.id===i.id&&o++}for(var d=0,f=n.output.synapses;d<f.length;d++){var l=f[d];l.origin.id===i.id&&o++}if(0===o)throw this.testPrintDebug(e,t,n),"Neuron has 0 synapses!"}}},e.prototype.testChildNetworkDoubleNeurons=function(e,t,n){for(var r=[],s=0,i=n.hidden;s<i.length;s++){var o=i[s];if(-1!==r.indexOf(o.id))throw this.testPrintDebug(e,t,n),"Network has multiple neurons with same id!";r.push(o.id)}},e.prototype.testPrintDebug=function(e,t,n){var r=new i.Species(e);e.fitness=1,r.networks.push(e);var s=new i.Species(t);t.fitness=1,s.networks.push(t),n.fitness=0;var o=new i.Species(n);o.networks.push(n),this.speciesArray=[r,s,o]},e}();t.Runner=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(4),i=n(6),o=function(){function e(){this.inputs=[],this.hidden=[],this.fitness=0}return e.prototype.initBasicNetwork=function(){r.GLOBALS.currentNeuronId=0,r.GLOBALS.currentSynapseId=0;var e=new s.Neuron(r.GLOBALS.currentNeuronId++),t=new s.Neuron(r.GLOBALS.currentNeuronId++),n=new s.Neuron(r.GLOBALS.currentNeuronId++);n.value=1,this.inputs.push(e),this.inputs.push(t),this.inputs.push(n);var o=new i.Synapse(r.GLOBALS.currentSynapseId++,e);this.output=new s.Neuron(r.GLOBALS.currentNeuronId++,[o])},e.prototype.evaluate=function(){var e=this.output.getValue();this.output.calculating=!1;for(var t=0,n=this.hidden;t<n.length;t++){n[t].calculating=!1}return e},e.prototype.mutate=function(){for(var e=0,t=this.hidden;e<t.length;e++)for(var n=t[e],o=0,a=n.synapses;o<a.length;o++){var u=a[o],h=Math.random();h<r.CONFIG.weightMutation&&(u.weight=20*Math.random()-10)}for(var p=0,v=this.output.synapses;p<v.length;p++){var u=v[p];Math.random()<r.CONFIG.weightMutation&&(u.weight=20*Math.random()-10)}var l=Math.random();if(l<r.CONFIG.synapseMutation){var d=!1,f=Math.floor(Math.random()*(this.hidden.length+1+2+1)),g=Math.floor(Math.random()*(this.hidden.length+1)),c=void 0,y=void 0;c=f===this.hidden.length+3?this.output:f<3?this.inputs[f]:this.hidden[f-3],y=g===this.hidden.length?this.output:this.hidden[g];for(var w=0,N=y.synapses;w<N.length;w++){var u=N[w];if(u.origin.id===c.id){u.enabled?u.enabled=!1:u.enabled=!0,d=!0;break}}if(!d)for(var I=0,S=r.GLOBALS.synapseMutations;I<S.length;I++){var O=S[I];if(O.originId===c.id&&O.targetId===y.id){var k=new i.Synapse(O.synapseId,c);y.synapses.push(k),d=!0;break}}if(!d){var k=new i.Synapse(r.GLOBALS.currentSynapseId++,c);y.synapses.push(k),r.GLOBALS.synapseMutations.push({synapseId:k.innovation,originId:k.origin.id,targetId:y.id})}}if((l=Math.random())<r.CONFIG.neuronMutation){for(var b=[],M=0,L=this.hidden;M<L.length;M++)for(var n=L[M],G=0,A=n.synapses;G<A.length;G++){var u=A[G];b.push({synapse:u,target:n})}for(var m=0,F=this.output.synapses;m<F.length;m++){var u=F[m];b.push({synapse:u,target:this.output})}var B=b[Math.floor(Math.random()*b.length)];B.synapse.enabled=!1;for(var P=0,C=r.GLOBALS.neuronMutations;P<C.length;P++){var O=C[P];if(O.synapseId===B.synapse.innovation&&!this.doesNeuronExist(O.neuronId)){var _=new i.Synapse(O.newSynapse1Id,B.synapse.origin),W=new s.Neuron(O.neuronId,[_]);this.hidden.push(W);var x=new i.Synapse(O.newSynapse2Id,W);return void B.target.synapses.push(x)}}var j=new i.Synapse(r.GLOBALS.currentSynapseId++,B.synapse.origin),D=new s.Neuron(r.GLOBALS.currentNeuronId++,[j]);this.hidden.push(D);var z=new i.Synapse(r.GLOBALS.currentSynapseId++,D);B.target.synapses.push(z),r.GLOBALS.neuronMutations.push({neuronId:D.id,synapseId:B.synapse.innovation,newSynapse1Id:j.innovation,newSynapse2Id:z.innovation})}},e.prototype.isSynapseInHiddenWithId=function(e){for(var t=0,n=this.hidden;t<n.length;t++)for(var r=n[t],s=0,i=r.synapses;s<i.length;s++){var o=i[s];if(o.innovation===e)return{result:!0,weight:o.weight}}return{result:!1,weight:0}},e.prototype.isSynapseInOutputWithId=function(e){for(var t=0,n=this.output.synapses;t<n.length;t++){var r=n[t];if(r.innovation===e)return{result:!0,weight:r.weight}}return{result:!1,weight:0}},e.prototype.findNeuronWithId=function(e){if(this.output.id===e)return this.output;for(var t=0,n=this.inputs;t<n.length;t++){var r=n[t];if(r.id===e)return r}for(var s=0,i=this.hidden;s<i.length;s++){var r=i[s];if(r.id===e)return r}throw"Neuron not found!"},e.prototype.doesNeuronExist=function(e){for(var t=0,n=this.hidden;t<n.length;t++){if(n[t].id===e)return!0}return!1},e.prototype.deepCopy=function(){for(var t=new e,n=0,r=this.inputs;n<r.length;n++){var s=r[n];t.inputs.push(s.clone())}for(var i=0,o=this.hidden;i<o.length;i++){var s=o[i];t.hidden.push(s.clone())}t.output=this.output.clone();for(var a=0,u=this.hidden;a<u.length;a++)for(var s=u[a],h=0,p=s.synapses;h<p.length;h++){var v=p[h],l=t.findNeuronWithId(v.origin.id),d=t.findNeuronWithId(s.id),f=v.clone(l);d.synapses.push(f)}for(var g=0,c=this.output.synapses;g<c.length;g++){var v=c[g],l=t.findNeuronWithId(v.origin.id),f=v.clone(l);t.output.synapses.push(f)}return t.fitness=this.fitness,t},e.prototype.serialize=function(){for(var e=[],t=[],n=0,r=this.inputs;n<r.length;n++){var s=r[n];t.push({id:s.id,value:s.value})}for(var i=[],o=0,a=this.hidden;o<a.length;o++){var s=a[o];i.push({id:s.id,value:s.value});for(var u=0,h=s.synapses;u<h.length;u++){var p=h[u];e.push({innovation:p.innovation,weight:p.weight,enabled:p.enabled,originId:p.origin.id,targetId:s.id})}}for(var v={id:this.output.id,value:this.output.value},l=0,d=this.output.synapses;l<d.length;l++){var p=d[l];e.push({innovation:p.innovation,weight:p.weight,enabled:p.enabled,originId:p.origin.id,targetId:this.output.id})}return{inputs:t,hidden:i,output:v,synapses:e,fitness:this.fitness}},e.prototype.toString=function(){console.log("inputs:");for(var e=0,t=this.inputs;e<t.length;e++){var n=t[e];console.log("value:",n.value);for(var r=0,s=n.synapses;r<s.length;r++){var i=s[r];console.log("\tweight:",i.weight)}}console.log("hidden:");for(var o=0,a=this.hidden;o<a.length;o++){var n=a[o];console.log("value:",n.value);for(var u=0,h=n.synapses;u<h.length;u++){var i=h[u];console.log("\tweight:",i.weight)}}console.log("ouput:"),console.log("value:",this.output.value);for(var p=0,v=this.output.synapses;p<v.length;p++){var i=v[p];console.log("\tweight:",i.weight)}},e}();t.Network=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=[]),this.value=0,this.calculating=!1,this.id=e,this.synapses=t}return e.prototype.clone=function(){var t=new e(this.id);return t.value=this.value,t},e.prototype.getValue=function(){if(0===this.synapses.length)return this.value;if(!0===this.calculating)return 1/(1+Math.exp(-4.9*this.value));this.calculating=!0;for(var e=0,t=0,n=this.synapses;t<n.length;t++){var r=n[t];r.enabled&&(e+=r.origin.getValue()*r.weight)}return this.value=e,1/(1+Math.exp(-4.9*this.value))},e}();t.Neuron=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(){function e(e){this.networks=[],this.averageFitness=0,this.desiredPopulation=0,this.representant=e}return e.prototype.inSpecies=function(e){for(var t=r.CONFIG.sameSpeciesThreshold,n=r.CONFIG.c1,s=r.CONFIG.c2,i=r.CONFIG.c3,o=0,a=0,u=0,h=0,p=0,v=0,l=0,d=this.representant.hidden;l<d.length;l++)for(var f=d[l],g=0,c=f.synapses;g<c.length;g++){var y=c[g];y.innovation>p&&(p=y.innovation),v++}for(var w=0,N=this.representant.output.synapses;w<N.length;w++){var y=N[w];y.innovation>p&&(p=y.innovation),v++}for(var I=0,S=0,O=0,k=e.hidden;O<k.length;O++)for(var b=k[O],M=0,L=b.synapses;M<L.length;M++){var G=L[M];G.innovation>I&&(I=G.innovation),S++}for(var A=0,m=e.output.synapses;A<m.length;A++){var G=m[A];G.innovation>I&&(I=G.innovation),S++}var F=Math.min(p,I);h=Math.max(v,S);for(var B=0,P=0,C=this.representant.hidden;P<C.length;P++)for(var f=C[P],_=0,W=f.synapses;_<W.length;_++){for(var y=W[_],x=!1,j=0,D=e.hidden;j<D.length;j++)for(var b=D[j],z=0,R=b.synapses;z<R.length;z++){var G=R[z];y.innovation===G.innovation&&(x=!0,B++,u+=Math.abs(y.weight-G.weight))}x||(y.innovation>F?o++:a++)}for(var J=0,V=this.representant.output.synapses;J<V.length;J++){for(var y=V[J],x=!1,E=0,H=e.output.synapses;E<H.length;E++){var G=H[E];if(y.innovation===G.innovation){x=!0,B++,u+=Math.abs(y.weight-G.weight);break}}x||(y.innovation>F?o++:a++)}for(var T=0,q=e.hidden;T<q.length;T++)for(var b=q[T],K=0,Q=b.synapses;K<Q.length;K++){for(var G=Q[K],x=!1,U=0,X=this.representant.hidden;U<X.length;U++)for(var f=X[U],Y=0,Z=f.synapses;Y<Z.length;Y++){var y=Z[Y];y.innovation===G.innovation&&(x=!0)}x||(G.innovation>F?o++:a++)}for(var $=0,ee=e.output.synapses;$<ee.length;$++){for(var G=ee[$],x=!1,te=0,ne=this.representant.output.synapses;te<ne.length;te++){var y=ne[te];if(y.innovation===G.innovation){x=!0;break}}x||(G.innovation>F?o++:a++)}return u/=B,(n*o+s*a)/h+i*u<t},e.prototype.serialize=function(){for(var e=[],t=0,n=this.networks;t<n.length;t++){var r=n[t];e.push(r.serialize())}return{representant:this.representant.serialize(),networks:e,averageFitness:this.averageFitness,desiredPopulation:this.desiredPopulation}},e}();t.Species=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.weight=2*Math.random()-1,this.enabled=!0,this.innovation=e,this.origin=t}return e.prototype.clone=function(t){var n=new e(this.innovation,t);return n.weight=this.weight,n.enabled=this.enabled,n},e}();t.Synapse=r}]);